{% extends "layout.html" %}
{% block content %}
<div class="d-flex justify-content-between flex-wrap align-items-center mb-4">
    <h3 class="mb-0">Manage Diversions: {{ device.name }}</h3>
    <small class="text-muted">Reading from: <code>voice translation-rule 2</code></small>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-light">
            <tr>
                <th scope="col" class="d-none d-md-table-cell">Rule ID</th>
                <th scope="col">Source</th>
                <th scope="col">Current</th>
                <th scope="col">New Dest</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for rule in rules %}
            <tr>
                <form method="POST" class="mb-0">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <td class="d-none d-md-table-cell align-middle">
                        {{ rule.id }}
                        <input type="hidden" name="rule_id" value="{{ rule.id }}">
                        <input type="hidden" name="raw_source" value="{{ rule.raw_source }}">
                    </td>
                    <td class="align-middle">
                        <strong>{{ rule.source }}</strong>
                        <div class="d-md-none text-muted small">Rule {{ rule.id }}</div>
                    </td>
                    <td class="align-middle">
                        <span class="badge bg-info">{{ rule.destination }}</span>
                    </td>
                    <td class="align-middle">
                        <input type="number" name="new_dest" class="form-control form-control-sm" placeholder="New Number" required>
                    </td>
                    <td class="align-middle">
                        <button type="submit" class="btn btn-success btn-sm w-100" onclick="return confirm('Change rule {{rule.id}} diversion to ' + this.form.new_dest.value + '?');">
                            <i class="bi bi-arrow-repeat"></i> Update
                        </button>
                    </td>
                </form>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if rules|length == 0 %}
<div class="alert alert-info mt-4">
    No diversion rules found for this device.
</div>
{% endif %}
{% endblock %}
